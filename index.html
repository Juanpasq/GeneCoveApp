<!DOCTYPE html>
<html>

<head>

    <script defer src="https://use.fontawesome.com/releases/v5.0.9/js/all.js" integrity="sha384-8iPTk2s/jMVj81dnzb/iFR2sdA7u06vHJyyLlAd4snFpCl/SnyUjRrbdJsw1pGIl"
        crossorigin="anonymous"></script>

    <!-- JQuery 3.1 -->
    <script src="http://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
        crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
        crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous"></script>

    <script type="text/javascript" src="jscript.js"></script>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/css/bootstrap-select.min.css">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/js/bootstrap-select.min.js"></script>

    <!-- (Optional) Latest compiled and minified JavaScript translation files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/js/i18n/defaults-*.min.js"></script>

    <style>
        body {
            font-family: 'Hind Madurai', sans-serif;
            font-size: 16px;
        }

        p {
            font-size: .9em;
            text-align: justify;

        }


        .table-responsive {

            @include media-breakpoint-up(md) {
                display: table;
            }
        }

        table {

            width: 500px;
            margin: 0 auto;
            font-size: 0.85em;
            text-align: auto;
            align-content: center;
            align-items: center;

        }


        th {

            margin: 0 auto;
        }

        td {

            text-align: justify;
            max-width: 300px;
            overflow: hidden;
            white-space: nowrap;
        }

        td:hover {
            overflow-x: visible;
        }
    </style>

</head>

<body>

    <!-- NavBar -->
    <nav class="navbar navbar-inverse" style="border-radius:0px;">
        <!-- Arreglo temporal: No se si corresponde modificar el el border radius del navbar desde aca o el estilo  -->
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">
                    <span style="font-family: 'Didact-Gothic', sans-serif;">GeneCovApp</span>
                </a>
            </div>
            <div class="collapse navbar-collapse" id="myNavbar" navbar-right>

                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#">
                            <i class="fas fa-user-md"></i>&nbsp;&nbsp;About</a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="fas fa-dna"></i>&nbsp;&nbsp;Gene</a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="fas fa-code"></i>&nbsp;&nbsp;Code</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- contenido general-->
    <div class="container">


        <h1 id="home-title" style="font-size: 50px; text-align:center;">GeneCovApp</h1>
        <p class="text-muted" style="font-size: 24px; text-align:center;"> A simple webapp for a priori and a posteriori evaluation of experimental design in clinical NGS </p>

        <!-- <h4 style="text-align:center"> A webapp for a priori and a posteriori evaluation of experimental designs in clinical NGS</h4> -->

        <br>

        <div padding class="form-group" style=" margin: 0 auto; padding:1em; max-width: 800px; text-align: center;">

            <!-- sector de input -->
            <div class="row">
                <div class="col-md-12">
                    <div class="input-group" id="adv-search">
                        <input type="text" id="input-csv" class="form-control" placeholder="Search code" onkeyup="this.value = this.value.toUpperCase();"
                            style="max-width:770px;" />
                        <span class="form-control-clear glyphicon glyphicon-remove form-control-feedback hidden"></span>
                        <!--boton upload file-->
                        <div class="input-group-btn">
                            <label class="btn" id="btn-csv" style="background-color: rgb(32, 32, 32); color: aliceblue;">
                                CSV&nbsp;
                                <i class="fas fa-upload"></i>
                                <input type="file" id="file-input" accept=".csv" style="display: none;">
                            </label>
                        </div>
                        <!--FIN boton upload file-->

                    </div>
                </div>
            </div>

            <p style="font-size:0.8em; margin: 0 auto;text-align: center;">Add a comma separated list of Genes.

                <span>* For example</span> : UBE3A =&gt; Coverage CDS:
                <span>0.824</span> ; Coverage CDSUTR:
                <span>0.431</span> ; Pathog. Var:
                <span>134</span>
            </p>
            <br>

            <!--armar el select de kitname, no se por que no me funciona desde el archivo js, lo tengo que poner aca-->


            <!-- Al parecer los metodos cross origin request no permiten cargar archivos locales. Yo probe levantando la rest API y por alguna cuestion de permisos que no entiendo bien no le puedo pegar al json. 

            CONSOLE: Failed to load file:///home/geronimodubra/BIA/git/vista/genesHTML/kits.json: Cross origin requests are only supported for protocol schemes: http, data, chrome, chrome-extension, https.

            -->


            <!-- Para probar el script:

            - ir al directorio genesHtml y levantar un server simple (con python por ej: python2 -m SimpleHTTPServer levanta en localhost:8000 el index.html y en localhost:8000/kits.json el archivo con los kits)
                
            - cambiar la primera linea a:

                $.getJSON("localhost:8000/kits.json", function (kitjson) {

            - por el navegador entrar a localhost:8000

            - Y voila, el selector anda a la perfeccion

             -->

            <!-- sector multiple select-->
            <div class="row" id="adv-search">
                <div class="col-md-12">
                    <div class="input-group" id="btn-render">
                        <select id="selectKit" class="selectpicker" multiple title="Capture Kit" name="selectKit" data-actions-box="true" data-selected-text-format="count > 2"
                            style=" text-align: center; margin: 0 auto;" data-width="55%" multiple data-max-options="20">
                            <!-- inserta dinamicamente option-->

                        </select>

                        <!-- boton input BED file -->
                        <div class="input-group-btn">
                            <label class="btn" id="btn-bed" style="background-color: rgb(32, 32, 32); color:aliceblue">
                                BED&nbsp;
                                <i class="fas fa-upload"></i>
                                <input type="file" accept=".bed" style="display: none;" id="input-bed">
                            </label>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <!-- boton launch procesar -->
        <div padding class="row " style="margin: 0 auto;padding:1em; max-width:420px; text-align: justify;display: flex;
        justify-content: center;">
            <div id="btn-launch" onclick="url()" style=" padding-right:5px;width: 200px; float: left; margin:0 auto;" class="btn btn-success  btn-block">Launch</div>
            <div disabled class="btn btn-secondary">&nbsp;</div>
            <div id="btn-clean" onclick="clean()" style=" width:200px; float: left; color: aliceblue; margin: 0 auto; background-color: rgba(12, 10, 10, 0.61);"
                class="btn btn-secondary btn-block">Clean</div>
        </div>


        <script>


            ///funcion btn cancelar ////
            function clean() {

                document.getElementById("input-csv").value = "";
                location.reload();

            }

            ////armar array con los kit seleccionados//////      
            var array = [];

            $('#selectKit').change(function () {
                // Obtener valor del las opciones selecionadas
                var selectValue = $("#selectKit").val();
                //  $("#resultadoValue").text(selectValue);
                // ver como queda el array de seleccionados final/////
                console.log(selectValue);
                array = selectValue;

                /// Obtener el texto del las opciones selecionadas////
                /* var selectText = $("#selectKit option:selected").map(function () {
                    return $(this).text();
                    }).get().join(',');
                    $('#resultadoTexto').text(selectText); */
            });

            ////armardo de la url con el id kit seleccionado y los valores genes////// 
            function url() {

                var ipServer = "10.100.100.55:8081";
                var kitsSeleccionados = array.toString();

                //////traemos los valores de los genes introducidos en el input/////////
                var csvValues = document.getElementById('input-csv').value;
                csvValues = csvValues.split(",");
                console.log("http://" + ipServer + "/genecovapp/getGeneStats/" + kitsSeleccionados + "/" + csvValues + "");
                //            window.open("http://"+ipServer+"/genecovapp/getGeneStats/" + kitsSeleccionados + "/" + csvValues + "");                  
                //window.open("tabla.html");


                /////armamos una variable para traer el archivo json/////
                var urlProcesada = "http://" + ipServer + "/genecovapp/getGeneStats/" + kitsSeleccionados + "/" + csvValues + "";

                ///buscamos las propiedades de los genes seleccionados en la url resultado///
                $.getJSON(urlProcesada, function (genesjson) {

                    console.log("entro >>> " + genesjson[0]["genes"][0].symbol);
                    console.log("longitud array KIT >>> " + genesjson.length);
                    console.log("longitud array GENES >>> " + genesjson[0]["genes"].length);

                    ////recorremos para buscar el KIT////

                    for (k = 0; k < genesjson.length; k++) {

                        var kitname = genesjson[k].name;
                        console.log("KITNAME : " + kitname);

                        var tabla = document.getElementById("contenidoTabla");
                        var fila = document.createElement("tr")
                        var row = document.createElement("th");
                        var celda = document.createElement("td");
                        row.setAttribute("colSpan", "7");
                        row.setAttribute("align", "center");
                        row.setAttribute("style", "background-color: #A91640;");
                        row.style.color = '#F7F4F3';
                        row.style.margin = "0 auto";


                        var texto = document.createTextNode(kitname);

                        celda.appendChild(texto);
                        row.appendChild(celda);
                        fila.appendChild(row);
                        tabla.appendChild(fila);



                        ///subrecorrido para encontrar los genes dentro de ese kit de cover//////

                        console.log("GENES DENTRO DEL KIT :  " + genesjson[k]["genes"].length);

                        for (g = 0; g < genesjson[k]["genes"].length; g++) {

                            console.log(genesjson[k]["genes"][g].symbol);
                            var symbol = genesjson[k]["genes"][g].symbol;

                            console.log(genesjson[k]["genes"][g].coverageCDS);
                            var coverageCDS = genesjson[k]["genes"][g].coverageCDS.toFixed(2);

                            console.log(genesjson[k]["genes"][g].coverageCDSUTR);
                            var coverageCDSUTR = genesjson[k]["genes"][g].coverageCDSUTR.toFixed(2);



                            console.log(genesjson[k]["genes"][g].pathogenicVariants);
                            var pathogenicVariants = genesjson[k]["genes"][g].pathogenicVariants.toFixed(2);

                            console.log(genesjson[k]["genes"][g].pathogenicVariantsCover);
                            var pathogenicVariantsCover = genesjson[k]["genes"][g].pathogenicVariantsCover.toFixed(2);

                            console.log(genesjson[k]["genes"][g].variantNotCovered);
                            var variantNotCovered = genesjson[k]["genes"][g].variantNotCovered;

                            console.log(genesjson[k]["genes"][g].synonyms);
                            var synonyms = genesjson[k]["genes"][g].synonyms;

                            /////////traemos la tabla y creamos las celdas//////////
                            var tabla = document.getElementById("contenidoTabla");

                            //una fila//
                            var fila = document.createElement("tr")

                            //por cada celda una col (cada th hay un td) = 7//
                            var row = document.createElement("th");
                            var row2 = document.createElement("th");
                            var row3 = document.createElement("th");
                            var row4 = document.createElement("th");
                            var row5 = document.createElement("th");
                            var row6 = document.createElement("th");
                            var row7 = document.createElement("th");

                            var celda1 = document.createElement("td");
                            var celda2 = document.createElement("td");
                            var celda3 = document.createElement("td");

                            celda3.style.textAlign = "center";
                            var celda4 = document.createElement("td");
                            var celda5 = document.createElement("td");
                            var celda6 = document.createElement("td");
                            var celda7 = document.createElement("td");

                            //textos de las 7 celdas//
                            var texto1 = document.createTextNode(symbol);
                            var texto2 = document.createTextNode(coverageCDS);
                            var texto3 = document.createTextNode(coverageCDSUTR);
                            var texto4 = document.createTextNode(pathogenicVariants);
                            var texto5 = document.createTextNode(pathogenicVariantsCover);
                            var texto6 = document.createTextNode(variantNotCovered);
                            var texto7 = document.createTextNode(synonyms);

                            //pegamos los componentes a sus padres//
                            celda1.appendChild(texto1);
                            celda2.appendChild(texto2);
                            celda3.appendChild(texto3);
                            celda4.appendChild(texto4);
                            celda5.appendChild(texto5);
                            celda6.appendChild(texto6);
                            celda7.appendChild(texto7);

                            row.appendChild(celda1);
                            row2.appendChild(celda2);
                            row3.appendChild(celda3);
                            row4.appendChild(celda4);
                            row5.appendChild(celda5);
                            row6.appendChild(celda6);
                            row7.appendChild(celda7);

                            fila.appendChild(row);
                            fila.appendChild(row2);
                            fila.appendChild(row3);
                            fila.appendChild(row4);
                            fila.appendChild(row5);
                            fila.appendChild(row6);
                            fila.appendChild(row7);

                            tabla.appendChild(fila);

                            ///FIN traemos la tabla y creamos las celdas///

                            var divTabla = document.getElementById("divTabla");
                            divTabla.style.visibility = "visible";
                        }
                    }

                });
            }

        </script>

        <hr style="max-width: 770px;">

        <!-- sector about texto-->

        <div style="max-width: 900px; margin:0 auto;">
            <h4>About GeneCovAPP</h4>
            <p style="font-size:.9em; text-align: justify">The Genecovapp is a web application aimed to be a strong and trustable tool for aiding throughout the process
                of experimental design for Clinical NGS.</p>
            <p style="font-size:.9em; text-align: justify;">Along our experience in Clinical NGS in
                <a href="http://www.biargentina.com.ar/"> BIA </a>, we have identified the experimental design as the first and one of the most challenging pitfalls
                to overcome in order to get the expected results. Developing of a tool that could help in this critical step
                can improve not only the times needed for beginning with NGS experiments, but also to acquiring a bigger
                rate of succes.</p>
            <p style="font-size:.9em; text-align: justify;">GeneCovApp allows users to check the coverage of diferent available commercial enrichment kits (or even your
                own design, by uploading a BED file) for a list of Genes or variants, by generating an interactive complete
                report containing the data required for correctly evaluating wich options are the best. This web application
                also provides a service for evaluating those experiments already done, by uploading your own VCFs files,
                and assesing the quality of the experimental design and compare these results with the data obtained from
                the a priori analysis.</p>
            <p style="font-size:.9em; text-align: justify;">Check the github page for the project if you are interested in the code behind GeneCovApp
                <a href="https://github.com">here</a>.</p>
        </div>

        <hr style="max-width: 770px;">


        <div class="table-responsive" style="visibility:hidden" id="divTabla">
            <a onclick="exportTableToCSV('genecove.csv')" href="#" class="btn btn-success">
                <span class="glyphicon glyphicon-floppy-save"></span> Download to csv</a>
            <p></p>
            <table class="table" id="tabla" style="align-items: center">
                <thead style="background-color: #2D2A2F; color: antiquewhite; margin: 0 auto">
                    <tr style="margin: 0 auto">
                        <th>Symbol</th>
                        <th>CovCDS</th>
                        <th>CovCDSUTR</th>
                        <th>PatVar</th>
                        <th>PatVarCov</th>
                        <th>VarNotCov</th>
                        <th>Synonyms</th>
                    </tr>
                </thead>
                <tbody id="contenidoTabla">
                    <!-- <tr>
                            <th></th>
                            <td></td>
                            <td>Otto</td>
                            <td>@mdo</td>
                        </tr> -->
                </tbody>
            </table>

        </div>


        <script>

            /////2 funciones para generar el csv y descarga////////////
            function downloadCSV(csv, filename) {
                var csvFile;
                var downloadLink;

                // CSV file
                csvFile = new Blob([csv], { type: "text/csv" });

                // Download link
                downloadLink = document.createElement("a");

                // File name
                downloadLink.download = filename;

                // Create a link to the file
                downloadLink.href = window.URL.createObjectURL(csvFile);

                // Hide download link
                downloadLink.style.display = "none";

                // Add the link to DOM
                document.body.appendChild(downloadLink);

                // Click download link
                downloadLink.click();
            }

            function exportTableToCSV(filename) {
                var csv = [];
                var rows = document.querySelectorAll("table tr");

                for (var i = 0; i < rows.length; i++) {
                    var row = [], cols = rows[i].querySelectorAll(" th");

                    for (var j = 0; j < cols.length; j++)
                        row.push(cols[j].innerText);

                    csv.push(row.join(","));
                }

                // Download CSV file
                downloadCSV(csv.join("\n"), filename);
            }

//////fin de 2 funciones para csv//////////////////
        </script>

        <!--
        <div id="contenedor">
            <input id="tab-1" type="radio" name="radio-set" class="tab-selector-1" checked="checked" />
            <label for="tab-1" class="tab-label-1">Pestaña1</label>

            <input id="tab-2" type="radio" name="radio-set" class="tab-selector-2" />
            <label for="tab-2" class="tab-label-2">Pestaña2</label>

            <input id="tab-3" type="radio" name="radio-set" class="tab-selector-3" />
            <label for="tab-3" class="tab-label-3">Pestaña3</label>

            <input id="tab-4" type="radio" name="radio-set" class="tab-selector-4" />
            <label for="tab-4" class="tab-label-4">Pestaña4</label>

            <div class="content">
                <div class="content-1">
                    Contenido1
                </div>
                <div class="content-2">
                    Contenido2
                </div>
                <div class="content-3">
                    Contenido3
                </div>
                <div class="content-4">
                    Contenido4
                </div>
            </div>
        </div> -->


        <!--Fin contenido general-->
    </div>

    <!-- file reader url externo template html que va con el script del js-->
    <!--<script  src="https://code.jquery.com/jquery-2.2.4.min.js"   integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="   crossorigin="anonymous"></script>

        URL JSON o FILE:<input type="text" id="input-url" size="50" value=""></input>

        <input type="button" id="button" value="Ver .txt"></input>
        <div class="text">
        <hr />
        <h2>Texto:</h2> -->

    <!-- fin file reader url externo -->



</body>

</html>